<html>
    <head>
        <title> The Map </title>
        <link rel="stylesheet" type="text/css" href="{{style}}">
    </head>

    <body onload="applyFilters()">
        <div id="header"> 
            <h1> The Pitt Print Tracking Map </h1> 
            
            <label for="printer_type_selector">Printer Color: 
            <select id="printer_type_selector" onchange="applyFilters()"> 
                <option value="any"> Any </option> 
                <option value="black and white"> Black and White </option> 
                <option value="color"> Color </option> 
            </select>
            </label>

            <label for="printer_status_selector">Printer Status: 
            <select id="printer_status_selector" onchange="applyFilters()"> 
                <option value="any"> Any </option> 
                <option value="online"> Online </option> 
                <option value="offline"> Offline </option> 
            </select>
            </label>

            <button class="logout-btn" onclick="window.location.href='{{reference_to_logout}}'">
                Logout
            </button>
        </div> 

        <div class="section">
            <h2 id="section-title">All Pitt Printers</h2>

            <ul id="printers_ul"> 
                {% for printer in printers %}
                <li class="printers_li printer-card 
                {% if printer.printer_type == 'Black & White' %}bnw{% elif printer.printer_type == 'Color' %}color{% endif %}
                {% if printer.printer_status == 'Online' %}online{% else %}offline{% endif %}">
                        <h3 class="printer-location">Printer Location: {{printer.printer_location}}
                        <h3>{{printer.printer_type}} Printer</h3> 
                        
                        {% if printer.printer_status == "Online" %}
                        <h3 class="status-badge status-online">Status: {{printer.printer_status}}</h3>   
                        {% else %}
                        <h3 class="status-badge status-offline">Status: {{printer.printer_status}}</h3>   
                        <h3 class="printer-issue">Printer Issue: {{printer.printer_issue}}</h3>
                        {% endif %}                        


                        <div class="card-buttons">
                            <a class="card" href="{{url_for('report_printer', printer_id=printer.id)}}">
                                <button class="btn btn-offline">Printer Offline?</button> 
                            </a>       
                        </div>          
                    </li> 
                {% endfor %}
            </ul> 
        </div> 

    </body> 
</html>

<script>
    function applyFilters(){
        const type = document.getElementById("printer_type_selector").value;
        const status = document.getElementById("printer_status_selector").value;

        const printers = document.querySelectorAll(".printer-card");

        printers.forEach(card => {
            let matchesType = true;
            let matchesStatus = true;

            //Color Filter
            if(type == "black and white"){
                matchesType = card.classList.contains("bnw");
            }
            else if (type == "color"){
                matchesType = card.classList.contains("color");
            }
            //Status Filter
            if(status == "online"){
                matchesStatus = card.classList.contains("online");
            }
            else if (status == "offline"){
                matchesStatus = card.classList.contains("offline");
            }
            //Add more filters here

            //Show if filters match
            if(matchesType && matchesStatus){
                card.style.display = "block";
            }
            else{
                card.style.display = "none";
            }
        });
    
    }
</script>

